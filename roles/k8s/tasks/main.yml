---
# Install system packages based on OS
- name: Install essential system packages (Debian)
  ansible.builtin.apt:
    name: "{{ common_packages }}"
    state: present
    update_cache: yes
  when: ansible_os_family == "Debian"

- name: Enable EPEL repository (RHEL/Fedora)
  ansible.builtin.dnf:
    name: epel-release
    state: present
  when: 
    - ansible_os_family in ["RedHat", "Fedora"]
    - common_install_packages | default(true)

- name: Install essential system packages (RHEL/Fedora)
  ansible.builtin.dnf:
    name: "{{ common_packages }}"
    state: present
    update_cache: yes
  when: 
    - ansible_os_family in ["RedHat", "Fedora"]
    - common_install_packages | default(true)

# Import K8s tool installation tasks
- import_tasks: kubectl.yml
  when: install_kubectl | default(true)

- import_tasks: minikube.yml
  when: install_minikube | default(true)

- import_tasks: k8s_tools.yml
  when: install_k8s_tools | default(true)
